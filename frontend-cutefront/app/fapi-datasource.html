<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>FAPIDataSourceWidget Test</title>
<link href="../lib/bootstrap-5.2.3-dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<p id="dump"></p>

<button id="create-button">Create</button>
<button id="read-button">Read</button>
<button id="update-button">Update</button>
<button id="delete-button">Delete</button>

</body>
<script src="../lib/bootstrap-5.2.3-dist/js/bootstrap.bundle.min.js"></script>

<script type="module">
import { DummyWidget, DumpWidget } from '../lib/base/widget.js';
import { FAPIMockDataSourceWidget } from './fapi-datasource.js';

var dummy_widget = new DummyWidget();
var dump_widget = new DumpWidget("dump");
var data_source = new FAPIDataSourceWidget();

data_source.setLogLevel(-1); // debugging

// Connect signals
data_source.signals.data.connect(
    dump_widget.slot.bind(dump_widget)
);
data_source.signals.error.connect(
    (message) => alert(message)
);

// Test buttons
document.getElementById("create-button").onclick = () => {
    data_source.create_slot({
        title: "New Item",
        description: "New description"
    });
};

document.getElementById("read-button").onclick = () => {
    data_source.read_slot();
};

document.getElementById("update-button").onclick = () => {
    if (data_source.data.length > 0) {
        const item = data_source.data[0];
        data_source.update_slot({
            uuid: item.uuid,
            title: item.title + " (updated)",
            description: item.description + " (updated)"
        });
    }
};

document.getElementById("delete-button").onclick = () => {
    if (data_source.data.length > 0) {
        data_source.delete_slot(data_source.data[0].uuid);
    }
};

// Initial read
data_source.read_slot();
</script>
</html>
